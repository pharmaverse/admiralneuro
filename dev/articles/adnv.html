<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating ADNV • admiralneuro</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating ADNV">
<meta name="robots" content="noindex">
<script async src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="2c7249cc-f1dc-4a63-8674-6ecbcb34d95c" data-project-name="admiral" data-project-color="#2c3e50" data-project-logo="https://pharmaverse.github.io/admiralneuro/logo.png" data-consent-required="true" data-user-analytics-cookie-enabled="true" data-consent-screen-title="Help us improve our AI assistant" data-consent-screen-disclaimer="By clicking 'Allow tracking', you consent to anonymous user tracking which helps us improve our service. We don't collect any personally identifiable information." data-consent-screen-accept-button-text="Allow tracking" data-consent-screen-reject-button-text="No, thanks" data-modal-example-questions="Tell me a little about the {admiralneuro} package., What are some important {admiralneuro} functions and what do they do?" data-modal-z-index="9999" data-modal-search-placeholder="Ask me a question about {admiralneuro} or the {admiral} ecosystem..."></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiralneuro</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.0.9012</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/admiralneuro.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><a class="dropdown-item" href="../articles/adpet.html">Creating ADTPET and ADAPET</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/website-versions.html" aria-label="Previous Release Websites"><span class="fa fa-history"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiralneuro/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiralneuro" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="adnv_files/dt-scroll-1.0.0/style.css" rel="stylesheet">
<script src="adnv_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="adnv_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="adnv_files/datatables-binding-0.34.0/datatables.js"></script><link href="adnv_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="adnv_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="adnv_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="adnv_files/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="adnv_files/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js"></script><script src="adnv_files/dt-ext-buttons-1.13.6/js/buttons.html5.min.js"></script><script src="adnv_files/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js"></script><script src="adnv_files/dt-ext-buttons-1.13.6/js/buttons.print.min.js"></script><link href="adnv_files/dt-ext-colreorder-1.13.6/css/colReorder.dataTables.min.css" rel="stylesheet">
<script src="adnv_files/dt-ext-colreorder-1.13.6/js/dataTables.colReorder.min.js"></script><link href="adnv_files/dt-ext-scroller-1.13.6/css/scroller.dataTables.min.css" rel="stylesheet">
<script src="adnv_files/dt-ext-scroller-1.13.6/js/dataTables.scroller.min.js"></script><link href="adnv_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="adnv_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="adnv_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="adnv_files/selectize-0.12.0/selectize.min.js"></script><link href="adnv_files/dt-plugin-searchhighlight-1.13.6/source.css" rel="stylesheet">
<script src="adnv_files/dt-plugin-searchhighlight-1.13.6/jquery.highlight.js"></script><script src="adnv_files/dt-plugin-searchhighlight-1.13.6/source.min.js"></script><link href="adnv_files/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="adnv_files/crosstalk-1.2.2/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating ADNV</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiralneuro/blob/main/vignettes/adnv.Rmd" class="external-link"><code>vignettes/adnv.Rmd</code></a></small>
      <div class="d-none name"><code>adnv.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article describes the creation of the <code>ADNV</code> (Nervous
System Analysis Dataset) ADaM.</p>
<p>The <code>ADNV</code> dataset focuses on olfactory function
assessments, specifically the University of Pennsylvania Smell
Identification Test (UPSIT). This vignette demonstrates the
neuro-specific steps for creating this BDS finding dataset.</p>
<p>We advise you first consult the <a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> <a href="https://pharmaverse.github.io/admiral/articles/bds_finding.html" class="external-link">Creating
a BDS Finding ADaM vignette</a>. The programming workflow around
creating the general set-up of a BDS ADaM dataset using
<a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> functions is the same. In this vignette, we focus
on the neuro-specific steps to avoid repeating information and
maintaining the same content in two places. As such, the code in this
vignette is not completely executable; we recommend consulting the
<code>ADNV</code> template script to view the full workflow.</p>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM
format as input unless otherwise specified.</em></p>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>The examples of this vignette require the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiralneuro/">admiralneuro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/pharmaversesdtm/" class="external-link">pharmaversesdtm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="programming-workflow">Programming Workflow<a class="anchor" aria-label="anchor" href="#programming-workflow"></a>
</h2>
<ul>
<li><a href="#readdata">Read in Data</a></li>
<li><a href="#adnv_setup">Initial Setup</a></li>
<li><a href="#paramcd">Assign <code>PARAMCD</code>, <code>PARAM</code>,
and <code>PARAMN</code></a></li>
<li><a href="#aval">Map <code>AVAL</code> and <code>AVALC</code>
variables</a></li>
<li><a href="#percentile">Convert UPSIT Score to Percentile</a></li>
<li><a href="#criterionfl">Derive Criterion Flag Variables for UPSIT
Percentile</a></li>
<li><a href="#dataset_end">Remaining Analysis Dataset Set-up</a></li>
</ul>
<div class="section level3">
<h3 id="readdata">Read in Data<a class="anchor" aria-label="anchor" href="#readdata"></a>
</h3>
<p>To start, all data frames needed for the creation of
<code>ADNV</code> should be loaded into the global environment. Reading
data will usually be a company specific process, however, for the
purpose of this vignette, we will use example data from
<a href="https://pharmaverse.github.io/pharmaversesdtm/" class="external-link">pharmaversesdtm</a> and <a href="https://pharmaverse.github.io/admiralneuro/">admiralneuro</a>. We will
utilize <code>NV</code> and <code>ADSL</code> for the basis of the
Nervous System Analysis dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nv</span> <span class="op">&lt;-</span> <span class="fu">pharmaversesdtm</span><span class="fu">::</span><span class="va"><a href="https://pharmaverse.github.io/pharmaversesdtm/reference/nv_neuro.html" class="external-link">nv_neuro</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/convert_blanks_to_na.html">convert_blanks_to_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">admiralneuro</span><span class="fu">::</span><span class="va"><a href="../reference/adsl_neuro.html">adsl_neuro</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/convert_blanks_to_na.html">convert_blanks_to_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adnv_setup">Initial Setup<a class="anchor" aria-label="anchor" href="#adnv_setup"></a>
</h3>
<p>The following steps are used to merge <code>ADSL</code> variables
with the source data <code>NV</code>, followed with filtering to retain
only UPSIT records. Common analysis variables such as Analysis Date
(<code>ADT</code>) and Relative Analysis Day (<code>ADY</code>) can also
be derived during this process. Note that only the sections relevant to
this vignette are included in the steps below. To get detailed guidance
on all the steps, refer to the <a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> <a href="https://pharmaverse.github.io/admiral/articles/bds_finding.html" class="external-link">Creating
a BDS Finding ADaM vignette</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">TRTSDT</span>, <span class="va">TRTEDT</span>, <span class="va">TRT01A</span>, <span class="va">TRT01P</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adnv</span> <span class="op">&lt;-</span> <span class="va">nv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/derive_vars_merged.html">derive_vars_merged</a></span><span class="op">(</span></span>
<span>    dataset_add <span class="op">=</span> <span class="va">adsl</span>,</span>
<span>    new_vars <span class="op">=</span> <span class="va">adsl_vars</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NVTESTCD</span> <span class="op">==</span> <span class="st">"UPSIT"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/derive_vars_dt.html">derive_vars_dt</a></span><span class="op">(</span></span>
<span>    new_vars_prefix <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>    dtc <span class="op">=</span> <span class="va">NVDTC</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/derive_vars_dy.html">derive_vars_dy</a></span><span class="op">(</span>reference_date <span class="op">=</span> <span class="va">TRTSDT</span>, source_vars <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">ADT</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="paramcd">Assign <code>PARAMCD</code>, <code>PARAM</code>, and
<code>PARAMN</code> variables<a class="anchor" aria-label="anchor" href="#paramcd"></a>
</h4>
<p>The next step is to create and assign parameter level variables such
as <code>PARAMCD</code>, <code>PARAM</code>, and <code>PARAMN</code>.
For this, a lookup can be created based on the SDTM
<code>--TESTCD</code> and <code>--CAT</code> values to join to the
source data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_lookup</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">NVTESTCD</span>, <span class="op">~</span><span class="va">NVCAT</span>, <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">PARAM</span>, <span class="op">~</span><span class="va">PARAMN</span>,</span>
<span>  <span class="st">"UPSIT"</span>, <span class="st">"OLFACTORY FUNCTION"</span>, <span class="st">"UPSITTS"</span>, <span class="st">"UPSIT Combined Score from 40 Odorant"</span>, <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This lookup may now be joined to the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adnv</span> <span class="op">&lt;-</span> <span class="va">adnv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/derive_vars_merged_lookup.html">derive_vars_merged_lookup</a></span><span class="op">(</span></span>
<span>    dataset_add <span class="op">=</span> <span class="va">param_lookup</span>,</span>
<span>    new_vars <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">PARAMCD</span>, <span class="va">PARAM</span>, <span class="va">PARAMN</span><span class="op">)</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">NVTESTCD</span>, <span class="va">NVCAT</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:auto;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;01-701-1015&quot;,&quot;01-701-1023&quot;,&quot;01-701-1028&quot;,&quot;01-701-1034&quot;,&quot;01-701-1146&quot;,&quot;01-701-1153&quot;,&quot;01-701-1181&quot;,&quot;01-701-1234&quot;,&quot;01-701-1275&quot;,&quot;01-701-1302&quot;,&quot;01-701-1345&quot;,&quot;01-701-1360&quot;,&quot;01-701-1383&quot;,&quot;01-701-1392&quot;,&quot;01-714-1288&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;UPSIT&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;OLFACTORY FUNCTION&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;UPSITTS&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;UPSIT Combined Score from 40 Odorant&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons","ColReorder","Scroller"],"data":[["01-701-1015","01-701-1023","01-701-1028","01-701-1034","01-701-1146","01-701-1153","01-701-1181","01-701-1234","01-701-1275","01-701-1302","01-701-1345","01-701-1360","01-701-1383","01-701-1392","01-714-1288"],["UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT","UPSIT"],["OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION","OLFACTORY FUNCTION"],["UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS","UPSITTS"],["UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant","UPSIT Combined Score from 40 Odorant"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>USUBJID<\/th>\n      <th>NVTESTCD<\/th>\n      <th>NVCAT<\/th>\n      <th>PARAMCD<\/th>\n      <th>PARAM<\/th>\n      <th>PARAMN<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":[],"visible":false},{"className":"dt-right","targets":5},{"name":"USUBJID","targets":0},{"name":"NVTESTCD","targets":1},{"name":"NVCAT","targets":2},{"name":"PARAMCD","targets":3},{"name":"PARAM","targets":4},{"name":"PARAMN","targets":5}],"searchHighlight":true,"searching":true,"pageLength":5,"lengthMenu":[5,10,15,20,50,100],"dom":"<Bfr<\"dt-scroll\"t>ipl>","buttons":[{"extend":"colvis","text":"Choose the columns to display","scroller":true,"collectionLayout":"fixed two-column"}],"colReorder":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="aval">Map <code>AVAL</code> and <code>AVALC</code> variables<a class="anchor" aria-label="anchor" href="#aval"></a>
</h4>
<p>Now that the parameter-level variables have been created, we can map
the Analysis Value variables. For these parameters, no complex
derivation is required. Note that <code>AVALC</code> should only be
mapped if it contains non-redundant information.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adnv</span> <span class="op">&lt;-</span> <span class="va">adnv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    AVAL <span class="op">=</span> <span class="va">NVSTRESN</span>,</span>
<span>    AVALC <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NVSTRESN</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">NVSTRESN</span><span class="op">)</span> <span class="op">!=</span> <span class="va">NVSTRESC</span>,</span>
<span>      <span class="va">NVSTRESC</span>,</span>
<span>      <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We then drop AVALC column because it contains no non-missing
values</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">adnv</span><span class="op">$</span><span class="va">AVALC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">adnv</span> <span class="op">&lt;-</span> <span class="va">adnv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">AVALC</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="percentile">Convert UPSIT Score to Percentile<a class="anchor" aria-label="anchor" href="#percentile"></a>
</h3>
<p>The <strong>UPSIT (University of Pennsylvania Smell Identification
Test)</strong> is a standardized test that measures olfactory function
using 40 odor identification items. The raw UPSIT score ranges from 0 to
40, with higher scores indicating better olfactory function.</p>
<p>To enable meaningful interpretation across different age and sex
groups, raw UPSIT scores can be converted to
<strong>percentiles</strong> based on normative data. These percentiles
represent where an individual’s performance ranks relative to age- and
sex-matched peers.</p>
<p>In the following steps, we will incorporate the
<strong>conversion</strong> from <strong>UPSIT total score to
percentile</strong> using the function
<code><a href="../reference/compute_upsit_percentile.html">admiralneuro::compute_upsit_percentile()</a></code>.</p>
<p><strong>1. Define the Source Variables</strong></p>
<p>The first step is to define <code>keep_vars</code>, which lists the
source variables to retain and copy into newly derived records in the
next step; all other variables will remain in the dataset but will be
set to <code>NA</code> in those derived rows.</p>
<p><strong>2. Convert UPSIT Score to Percentile</strong></p>
<p>The second step creates new analysis records in which the original
<code>UPSITTS</code> values are converted into percentiles using
<code><a href="../reference/compute_upsit_percentile.html">admiralneuro::compute_upsit_percentile()</a></code>. The conversion is
based on the patient’s sex and age at the time of assessment.</p>
<p>The new parameter values which include <code>AVAL</code>,
<code>PARAMCD</code>, <code>PARAM</code>, and <code>PARAMN</code> are
assigned for the percentile parameter.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keep_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span>,</span>
<span>  <span class="va">adsl_vars</span>,</span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">ADT</span>, <span class="va">ADY</span>, <span class="va">VISIT</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare derived rows</span></span>
<span><span class="va">upsit_percentile</span> <span class="op">&lt;-</span> <span class="va">adnv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"UPSITTS"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    AVAL <span class="op">=</span> <span class="fu"><a href="../reference/compute_upsit_percentile.html">compute_upsit_percentile</a></span><span class="op">(</span></span>
<span>      sex <span class="op">=</span> <span class="va">SEX</span>,</span>
<span>      age <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>      upsit_score <span class="op">=</span> <span class="va">AVAL</span></span>
<span>    <span class="op">)</span>,</span>
<span>    PARAMCD <span class="op">=</span> <span class="st">"UPSITPC"</span>,</span>
<span>    PARAM <span class="op">=</span> <span class="st">"Percentile derived from UPSIT total score"</span>,</span>
<span>    PARAMN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    AVALU <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Bind with original dataset</span></span>
<span><span class="va">adnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">adnv</span>, <span class="va">upsit_percentile</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop AVALU because it contains no non-missing values</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">adnv</span><span class="op">$</span><span class="va">AVALU</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">adnv</span> <span class="op">&lt;-</span> <span class="va">adnv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">AVALU</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This is how the parameters and newly converted parameters will look
like:</p>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:auto;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;01-701-1015&quot;,&quot;01-701-1023&quot;,&quot;01-701-1028&quot;,&quot;01-701-1034&quot;,&quot;01-701-1146&quot;,&quot;01-701-1153&quot;,&quot;01-701-1181&quot;,&quot;01-701-1234&quot;,&quot;01-701-1275&quot;,&quot;01-701-1302&quot;,&quot;01-701-1345&quot;,&quot;01-701-1360&quot;,&quot;01-701-1383&quot;,&quot;01-701-1392&quot;,&quot;01-714-1288&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;UPSITPC&quot;,&quot;UPSITTS&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Percentile derived from UPSIT total score&quot;,&quot;UPSIT Combined Score from 40 Odorant&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"70\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1344124800000\" data-max=\"1404172800000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;BASELINE&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons","ColReorder","Scroller"],"data":[["01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034","01-701-1034","01-701-1146","01-701-1146","01-701-1153","01-701-1153","01-701-1181","01-701-1181","01-701-1234","01-701-1234","01-701-1275","01-701-1275","01-701-1302","01-701-1302","01-701-1345","01-701-1345","01-701-1360","01-701-1360","01-701-1383","01-701-1383","01-701-1392","01-701-1392","01-714-1288","01-714-1288"],["UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC"],["UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score"],[13,2,32,39.5,16,6,1,1,14,3,26,18.5,13,3,2,1,13,3,28,19,36,70,7,1,8,1,22,16.5,8,1],["2014-01-02","2014-01-02","2012-08-05","2012-08-05","2013-07-19","2013-07-19","2014-07-01","2014-07-01","2013-05-20","2013-05-20","2013-09-23","2013-09-23","2013-12-05","2013-12-05","2013-03-30","2013-03-30","2014-02-07","2014-02-07","2013-08-29","2013-08-29","2013-10-08","2013-10-08","2013-07-31","2013-07-31","2013-02-04","2013-02-04","2012-10-28","2012-10-28","2013-12-04","2013-12-04"],[1,1,1,1,null,null,1,1,1,1,1,1,null,null,1,1,1,1,1,1,null,null,null,null,1,1,1,1,null,null],["BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>USUBJID<\/th>\n      <th>PARAMCD<\/th>\n      <th>PARAM<\/th>\n      <th>AVAL<\/th>\n      <th>ADT<\/th>\n      <th>ADY<\/th>\n      <th>VISIT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":[],"visible":false},{"className":"dt-right","targets":[3,5]},{"name":"USUBJID","targets":0},{"name":"PARAMCD","targets":1},{"name":"PARAM","targets":2},{"name":"AVAL","targets":3},{"name":"ADT","targets":4},{"name":"ADY","targets":5},{"name":"VISIT","targets":6}],"searchHighlight":true,"searching":true,"pageLength":5,"lengthMenu":[5,10,15,20,50,100],"dom":"<Bfr<\"dt-scroll\"t>ipl>","buttons":[{"extend":"colvis","text":"Choose the columns to display","scroller":true,"collectionLayout":"fixed two-column"}],"colReorder":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><div class="section level4">
<h4 id="criterionfl">Derive Criterion Flag Variables for UPSIT Percentile<a class="anchor" aria-label="anchor" href="#criterionfl"></a>
</h4>
<p>Having converted the UPSIT score to percentile, we can now derive the
criterion flags for olfactory impairment categories.</p>
<p>We will use a percentile cutoff of <strong>10</strong> to define
olfactory impairment. The 10th percentile cutoff represents a sex- and
age-adjusted threshold for olfactory impairment based on normative data.
UPSIT percentile ≤ 10 is considered olfactory impairment, while UPSIT
percentile &gt; 10 is considered normal olfactory function.</p>
<p>To do this, we will use the
<code><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/derive_vars_crit_flag.html">admiral::derive_vars_crit_flag()</a></code> function. Since we want to
derive these flags specifically for the UPSIT percentile parameter, we
will apply the derivation only to those records using
<code><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/restrict_derivation.html">admiral::restrict_derivation()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adnv</span> <span class="op">&lt;-</span> <span class="va">adnv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/restrict_derivation.html">restrict_derivation</a></span><span class="op">(</span></span>
<span>    derivation <span class="op">=</span> <span class="va">derive_vars_crit_flag</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.4.1/cran-release/reference/params.html">params</a></span><span class="op">(</span></span>
<span>      crit_nr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      condition <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"UPSITPC"</span>, <span class="va">AVAL</span> <span class="op">&lt;=</span> <span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"UPSITPC &lt;= 10"</span>,</span>
<span>      values_yn <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># To get "Y", "N", and NA for the flag</span></span>
<span>    <span class="op">)</span>,</span>
<span>    filter <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"UPSITPC"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This is how the criterion flags will look like:</p>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:auto;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;01-701-1015&quot;,&quot;01-701-1023&quot;,&quot;01-701-1028&quot;,&quot;01-701-1034&quot;,&quot;01-701-1146&quot;,&quot;01-701-1153&quot;,&quot;01-701-1181&quot;,&quot;01-701-1234&quot;,&quot;01-701-1275&quot;,&quot;01-701-1302&quot;,&quot;01-701-1345&quot;,&quot;01-701-1360&quot;,&quot;01-701-1383&quot;,&quot;01-701-1392&quot;,&quot;01-714-1288&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;UPSITPC&quot;,&quot;UPSITTS&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Percentile derived from UPSIT total score&quot;,&quot;UPSIT Combined Score from 40 Odorant&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"70\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1344124800000\" data-max=\"1404172800000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;BASELINE&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;UPSITPC &lt;= 10&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;N&quot;,&quot;Y&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons","ColReorder","Scroller"],"data":[["01-701-1015","01-701-1015","01-701-1023","01-701-1023","01-701-1028","01-701-1028","01-701-1034","01-701-1034","01-701-1146","01-701-1146","01-701-1153","01-701-1153","01-701-1181","01-701-1181","01-701-1234","01-701-1234","01-701-1275","01-701-1275","01-701-1302","01-701-1302","01-701-1345","01-701-1345","01-701-1360","01-701-1360","01-701-1383","01-701-1383","01-701-1392","01-701-1392","01-714-1288","01-714-1288"],["UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS","UPSITPC","UPSITTS"],["Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant","Percentile derived from UPSIT total score","UPSIT Combined Score from 40 Odorant"],[2,13,39.5,32,6,16,1,1,3,14,18.5,26,3,13,1,2,3,13,19,28,70,36,1,7,1,8,16.5,22,1,8],["2014-01-02","2014-01-02","2012-08-05","2012-08-05","2013-07-19","2013-07-19","2014-07-01","2014-07-01","2013-05-20","2013-05-20","2013-09-23","2013-09-23","2013-12-05","2013-12-05","2013-03-30","2013-03-30","2014-02-07","2014-02-07","2013-08-29","2013-08-29","2013-10-08","2013-10-08","2013-07-31","2013-07-31","2013-02-04","2013-02-04","2012-10-28","2012-10-28","2013-12-04","2013-12-04"],[1,1,1,1,null,null,1,1,1,1,1,1,null,null,1,1,1,1,1,1,null,null,null,null,1,1,1,1,null,null],["BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE","BASELINE"],["UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null,"UPSITPC &lt;= 10",null],["Y",null,"N",null,"Y",null,"Y",null,"Y",null,"N",null,"Y",null,"Y",null,"Y",null,"N",null,"N",null,"Y",null,"Y",null,"N",null,"Y",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>USUBJID<\/th>\n      <th>PARAMCD<\/th>\n      <th>PARAM<\/th>\n      <th>AVAL<\/th>\n      <th>ADT<\/th>\n      <th>ADY<\/th>\n      <th>VISIT<\/th>\n      <th>CRIT1<\/th>\n      <th>CRIT1FL<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":[],"visible":false},{"className":"dt-right","targets":[3,5]},{"name":"USUBJID","targets":0},{"name":"PARAMCD","targets":1},{"name":"PARAM","targets":2},{"name":"AVAL","targets":3},{"name":"ADT","targets":4},{"name":"ADY","targets":5},{"name":"VISIT","targets":6},{"name":"CRIT1","targets":7},{"name":"CRIT1FL","targets":8}],"searchHighlight":true,"searching":true,"pageLength":5,"lengthMenu":[5,10,15,20,50,100],"dom":"<Bfr<\"dt-scroll\"t>ipl>","buttons":[{"extend":"colvis","text":"Choose the columns to display","scroller":true,"collectionLayout":"fixed two-column"}],"colReorder":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level3">
<h3 id="dataset_end">Remaining Analysis Dataset Set-up<a class="anchor" aria-label="anchor" href="#dataset_end"></a>
</h3>
<p>The <a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> <a href="https://pharmaverse.github.io/admiral/articles/bds_finding.html" class="external-link">Creating
a BDS Finding ADaM vignette</a> covers all the steps that are not shown
here, such as merging the timing variables, analysis flags, baseline
derivations, change from baseline calculations, etc.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-scripts">Example Scripts<a class="anchor" aria-label="anchor" href="#example-scripts"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>ADaM</th>
<th>Sourcing Command</th>
</tr></thead>
<tbody><tr class="odd">
<td>ADNV</td>
<td><code>admiral::use_ad_template("ADNV", package = "admiralneuro")</code></td>
</tr></tbody>
</table>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>University of Pennsylvania Smell Identification Test. (n.d.). In
<em>Wikipedia</em>. Retrieved from <a href="https://en.wikipedia.org/wiki/University_of_Pennsylvania_Smell_Identification_Test" class="external-link uri">https://en.wikipedia.org/wiki/University_of_Pennsylvania_Smell_Identification_Test</a></p>
<p>Brumm, M. C. <em>et al.</em> (2023). Updated Percentiles for the
University of Pennsylvania Smell Identification Test in Adults 50 Years
of Age and Older. <em>Neurology, 100</em>(16), e1691–e1701.</p>
<p>Mastenbroek, S. E. <em>et al.</em> (2025). Two-step detection of Lewy
body pathology via smell-function testing and CSF α-synuclein seed
amplification. <em>Nature Communications, 16</em>, 7182.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by F. Hoffmann-La Roche AG, Eli Lilly and Company, Cytel Inc., Jian Wang, Miles Almond, Xiao Chen, Fanny Gautier, Gayatri G., Meilin Jiang, Leena Khatri, Edoardo Mancini, Eric Nantz, Lina Patil, Chris Pelentrides.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
